Chrome 内网智能化助手 - 需求文档 (V4.2 for AI Programming)
项目名称： Chrome 内网智能化助手

目标： 开发一个高兼容性、高稳定性、独立于外部软件的Chrome扩展程序。专注于内网环境，提供便捷的用户操作录制功能，支持灵活的回放模式（后台静默或前台展示），具备多任务管理、快捷键快速触发能力。在用户配合浏览器设置的前提下，实现文件自动下载到预设的本地文件夹并自动确认保存。同时，增强URL配置功能，支持通配符匹配和动态参数化。新增自动点击上传文件按钮功能，但文件选择仍需用户手动完成。

1. 核心功能描述
1.1 多任务脚本管理
功能： 用户可以创建、命名、编辑、删除、复制、导入、导出（JSON格式）自动化脚本。
脚本属性： 每个脚本包含名称、描述、创建时间、最后运行时间、状态（启用/禁用）。
脚本编辑： 提供图形化界面编辑脚本步骤，包括增删改查、调整顺序、修改参数。
1.2 增强型启动URL配置
功能： 每个脚本可配置一个起始URL，脚本执行时首先导航到此URL。
通配符支持： 启动URL可包含通配符（如 *），以匹配URL中可变的部分。
示例： https://internal.example.com/item/*/details
动态变量支持： 启动URL可包含占位符变量（如 {projectId}），这些变量可在执行前由用户输入或通过其他脚本逻辑提供。
示例： https://internal.example.com/project/{projectId}/dashboard
内置宏： 支持预定义宏，如 {DATE_TODAY} (YYYY-MM-DD)，{TIME_HHMM} (HHMM)，{USER_INPUT_VAR_NAME} (触发用户输入)。
回放策略：
精确导航： 严格导航到解析后的完整URL。
通配符导航： 导航到第一个匹配通配符模式的页面。
录制时URL捕获： 录制器在开始时捕获当前URL，并提供用户编辑为模板URL的选项。
1.3 录制模块
功能： 录制用户在网页上的操作，并生成可编辑的自动化脚本步骤。
操作捕获类型：
点击事件： 记录用户对任何可点击元素的点击（按钮、链接、复选框、单选按钮、下载链接）。
文本输入： 记录用户在输入框中输入的文本。
下拉菜单选择： 记录用户在 select 元素中选择的选项。
页面导航/加载： 自动记录页面跳转，并确保回放时等待页面加载完成。
页面滚动： 记录滚动窗体的操作。
新增 文件上传按钮点击：
录制： 捕获用户对 <input type="file"> 元素或其代理元素的点击，将其标记为“上传文件按钮点击”步骤。
回放： 模拟点击此元素，触发浏览器文件选择对话框。用户必须手动选择文件。 脚本会等待用户完成选择后继续。
录制反馈： 录制时高亮当前操作的元素。
脚本编辑： 录制结束后提供界面编辑步骤，包括：
修改元素选择器（默认生成XPath，用户可编辑）。
调整步骤顺序。
删除、插入新步骤。
为每一步添加自定义等待时间。
修改输入文本或选择值。
配置下载文件名重命名规则。
配置上传后等待策略（如等待特定元素出现）。
1.4 回放引擎
功能： 按序执行脚本中的操作步骤，支持两种模式。
A. 后台静默回放模式：
在不可见的Chrome标签页中执行，无用户界面显示。
无用户交互，任务完成后自动关闭标签页。
适用于定时任务、批处理。
B. 前台展示回放模式：
在用户当前可见的Chrome窗口或新标签页中执行。
可视化执行，用户可看到每一步操作。
提供“暂停”、“继续”、“停止”控制按钮。
实时高亮当前操作元素。
适用于演示、调试、半自动流程。
共享回放特性：
多标签页/窗口支持： 能够在新的可见或不可见标签页/窗口中执行。
鲁棒元素定位： 优先ID，次之Name，然后Data属性，Class，最终使用XPath。失败时尝试备用选择器和重试。
动态等待：
固定延迟。
等待元素出现、可见或特定内容/属性值。
页面完全加载等待。
自定义等待步骤。
错误处理： 记录错误日志，支持重试、跳过步骤、停止任务。
会话管理： 利用当前Chrome会话Cookie保持登录状态。
1.5 受限文件下载管理
功能： 自动化下载文件，并提供文件命名建议。
核心限制：文件下载的自动保存到指定目录功能，要求用户必须手动在 Chrome 浏览器设置中：**
关闭“下载前询问每个文件的保存位置”选项。
设置固定的“下载位置”为目标文件夹。
如果用户未进行上述设置，扩展程序无法实现自动保存到预设目录。
下载识别： 录制器识别触发下载的点击事件或链接。回放时，使用 chrome.downloads.onCreated 监听下载事件。
文件重命名与子目录建议：
利用 chrome.downloads.onDeterminingFilename API，根据脚本配置实时修改下载文件的文件名，并可在用户默认下载目录下创建子目录。
支持基于页面内容、日期/时间戳、脚本名称的复杂命名规则。
支持自动处理文件名冲突。
下载状态： 在任务日志中记录下载进度和完成状态（文件名、路径、状态）。
1.6 定时任务管理
功能： 为脚本配置定时自动执行计划（仅支持后台静默模式）。
配置项： 运行时间（时、分）、频率（每天、每周、每月、仅一次）、启用/禁用状态。
管理： 任务队列、优先级设置、运行历史记录。
1.7 快捷键触发执行
功能： 用户可为每个脚本分配一个全局或Chrome特定快捷键组合。
即时执行： 按下快捷键立即启动脚本，可选择后台静默或前台展示模式。
管理： 提供快捷键的添加、修改、删除。
1.8 用户界面 (UI)
扩展弹出窗口 (Popup)：
录制/停止按钮。
显示最近任务状态。
进入完整管理页面的链接。
显示当前页面可用的快捷键任务。
“一键执行默认任务”入口。
独立管理页面 (Options Page)：
脚本管理： 列表、CRUD、导入/导出。
定时任务配置： 设定和管理定时任务。
快捷键配置： 绑定/解绑/修改快捷键与脚本，选择回放模式。
下载设置： 提示 Chrome 下载设置要求，配置重命名规则。
任务日志： 详细记录所有任务的执行结果、运行模式、耗时、错误信息、下载文件信息。支持过滤、导出。
全局设置： 默认延迟、超时时间、错误处理策略、日志保留。
2. 技术栈及平台
平台： Google Chrome Web Browser (桌面版)。
技术： Chrome Extension (Manifest V3)。
核心API：
chrome.storage (数据持久化)。
chrome.tabs / chrome.scripting (页面操作、注入脚本)。
chrome.alarms (定时任务)。
chrome.commands (快捷键)。
chrome.downloads (文件下载监听、命名建议)。
chrome.runtime / chrome.messages (扩展内部通信)。
UI 技术： HTML, CSS, JavaScript (可能搭配轻量级框架如 Vue/React 或纯JS)。
3.规则
生成readme.md文件，每一次的代码修改都在当中更新。